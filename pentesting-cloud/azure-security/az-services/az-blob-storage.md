# Az - Blob Storage

<details>

<summary><strong>Support HackTricks and get benefits!</strong></summary>

Do you work in a **cybersecurity company**? Do you want to see your **company advertised in HackTricks**? or do you want to have access the **latest version of the PEASS or download HackTricks in PDF**? Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!

Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)

Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)

**Join the** [**üí¨**](https://emojipedia.org/speech-balloon/) [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** me on **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/carlospolopm)**.**

**Share your hacking tricks submitting PRs to the** [**hacktricks github repo**](https://github.com/carlospolop/hacktricks)**.**

</details>

## Basic Information

Azure Blob storage is Microsoft's object **storage solution for the cloud**. Blob storage is optimized for storing massive amounts of unstructured data. Unstructured data is data that doesn't adhere to a particular data model or definition, such as text or binary data.

Blob storage offers three types of resources:

* The **storage account** (unique name)
* A **container** in the storage account (folder)
* A **blob** in a container

<figure><img src="../../../.gitbook/assets/image (6) (2).png" alt=""><figcaption></figcaption></figure>

### Different types of storage

| **Blob storage**                 | https://\<storage-account>.blob.core.windows.net  |
| -------------------------------- | ------------------------------------------------- |
| **Azure Data Lake Storage Gen2** | https://\<storage-account>.dfs.core.windows.net   |
| **Azure Files**                  | https://\<storage-account>.file.core.windows.net  |
| **Queue storage**                | https://\<storage-account>.queue.core.windows.net |
| **Table storage**                | https://\<storage-account>.table.core.windows.net |

### Access to Storage <a href="#about-blob-storage" id="about-blob-storage"></a>

* Use Azure AD principals via **RBAC roles** supported.
* **Access Keys**: Use access keys of the storage account. This provides f**ull access to the storage account.**
* **Shared Access Signature** (SAS): Time **limited** and specific permissions.
  * You can generate a SAS url with an access key (more complicated to detect).

### Public Exposure

If "Allow Blob public access" is **enabled** (disabled by default), it's possible to:

* Give **public access to read blobs** (you need to know the name).
* **List container blobs** and **read** them.

### Connect to Storage

If you find any **storage** you can connect to you could use the tool [**Microsoft Azure Storage Explorer**](https://azure.microsoft.com/es-es/products/storage/storage-explorer/) to do so.

## SAS URLs

A shared access signature (SAS) provides secure delegated access to resources in your storage account. With a SAS, you have granular control over how a client can access your data. For example:

* What resources the client may access.
* What permissions they have to those resources.
* How long the SAS is valid.

### User delegation SAS <a href="#user-delegation-sas" id="user-delegation-sas"></a>

You can **secure a shared access signature (SAS)** token for access to a container, directory, or blob by using either Azure Active Directory (Azure AD) **credentials or an account key**. To create a user delegation SAS, you must first request a ** **_**user delegation key**_, which you then use to sign the SAS.

A user delegation SAS is supported for **Azure Blob Storage** and **Azure Data Lake Storage Gen2**. Stored access policies are not supported for a user delegation SAS.

### Service SAS

A service SAS is secured with the **storage account key**. A service SAS **delegates access to a resource in only one** of the Azure Storage services: Blob storage, Queue storage, Table storage, or Azure Files. The URI for a service-level SAS consists of the URI to the resource for which the SAS will delegate access, followed by the SAS token.

To use Azure Active Directory (Azure AD) credentials to secure a SAS for a **container** or **blob**, user a **user delegation SAS**.

### Account SAS

An account SAS is secured with the storage account key. An account SAS delegates access to resources in one or more of the storage services. All of the operations available via a service or user delegation SAS are also available via an account SAS.

By creating an account SAS, you can:

* Delegate access to service-level operations that aren't currently available with a service-specific SAS, such as the `Get/Set Service Properties` and `Get Service Stats` operations.
* Delegate access to more than one service in a storage account at a time. For example, you can delegate access to resources in both Azure Blob Storage and Azure Files by using an account SAS.
* Delegate access to write and delete operations for containers, queues, tables, and file shares, which are not available with an object-specific SAS.
* Specify an IP address or a range of IP addresses from which to accept requests.
* Specify the HTTP protocol from which to accept requests (either HTTPS or HTTP/HTTPS).



\
\


## Enumeration

```powershell
# Get storage
Get-AzStorageAccount | fl
Get-AzStorageAccount | select -ExpandProperty NetworkRuleSet # Get rules to access the storage account
(Get-AzStorageAccount | select -ExpandProperty NetworkRuleSet).IPRules # Get IPs
```

## References

* [https://learn.microsoft.com/en-us/azure/storage/blobs/storage-blobs-introduction](https://learn.microsoft.com/en-us/azure/storage/blobs/storage-blobs-introduction)
* [https://learn.microsoft.com/en-us/azure/storage/common/storage-sas-overview](https://learn.microsoft.com/en-us/azure/storage/common/storage-sas-overview)

<details>

<summary><strong>Support HackTricks and get benefits!</strong></summary>

Do you work in a **cybersecurity company**? Do you want to see your **company advertised in HackTricks**? or do you want to have access the **latest version of the PEASS or download HackTricks in PDF**? Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!

Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)

Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)

**Join the** [**üí¨**](https://emojipedia.org/speech-balloon/) [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** me on **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/carlospolopm)**.**

**Share your hacking tricks submitting PRs to the** [**hacktricks github repo**](https://github.com/carlospolop/hacktricks)**.**

</details>
